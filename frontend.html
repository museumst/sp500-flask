<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‹¤ì‹œê°„ LSTM ì˜ˆì¸¡ ì‹œë®¬ë ˆì´í„°</title>
    <!-- Tailwind CSS ë¡œë“œ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js ë¡œë“œ -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .glass {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #3b82f6;
            animation: spin 1s ease infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .day {
            display: inline-block;
            width: 14.28%;
            text-align: center;
            padding: 8px 4px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: 4px;
        }
        .day:not(.empty-day):not(.future-day):hover {
            background-color: rgba(59, 130, 246, 0.2);
            transform: scale(1.05);
        }
        .day.selected {
            background-color: #3b82f6;
            color: white;
            font-weight: bold;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }
        .day.empty-day {
            visibility: hidden;
            cursor: default;
        }
        .day.future-day {
            color: #9ca3af;
            cursor: not-allowed;
        }
        .accuracy-indicator {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 16px;
            font-size: 0.875rem;
            font-weight: 600;
        }
        .accuracy-good {
            background-color: #10b981;
            color: white;
        }
        .accuracy-fair {
            background-color: #f59e0b;
            color: white;
        }
        .accuracy-poor {
            background-color: #ef4444;
            color: white;
        }
        .pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        .status-online {
            background-color: #10b981;
            animation: pulse 2s infinite;
        }
        .status-offline {
            background-color: #ef4444;
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <div class="glass p-8 rounded-3xl shadow-2xl max-w-5xl w-full transform transition-all duration-300 hover:scale-[1.02]">
        <h1 class="text-4xl font-bold mb-6 text-center text-white drop-shadow-lg">
            ğŸš€ ì‹¤ì‹œê°„ LSTM ì£¼ê°€ ì˜ˆì¸¡ ì‹œë®¬ë ˆì´í„°
        </h1>

        <!-- ì„œë²„ ìƒíƒœ í‘œì‹œ -->
        <div class="glass p-4 rounded-xl mb-6 text-center">
            <div id="server-status" class="text-white font-medium">
                <span id="status-indicator" class="status-indicator status-offline"></span>
                <span id="status-text">ì„œë²„ ì—°ê²° í™•ì¸ ì¤‘...</span>
            </div>
        </div>

        <p class="text-lg text-white/90 mb-8 text-center leading-relaxed">
            ì¢…ëª© ì½”ë“œë¥¼ ì…ë ¥í•˜ê³  ë‹¬ë ¥ì—ì„œ ê³¼ê±° ë‚ ì§œë¥¼ ì„ íƒí•˜ì—¬<br>
            <span class="font-semibold text-yellow-300">ì‹¤ì‹œê°„ ë°ì´í„°ë¡œ ì‹œê°„ ì—¬í–‰ ë°±í…ŒìŠ¤íŠ¸</span>ë¥¼ ê²½í—˜í•´ë³´ì„¸ìš”!
        </p>

        <!-- ì…ë ¥ ë° ë‹¬ë ¥ ì„¹ì…˜ -->
        <div class="grid lg:grid-cols-2 gap-8 mb-8">
            <div class="space-y-4">
                <label for="stock-ticker" class="block text-white font-semibold text-lg">
                    ğŸ“ˆ ì¢…ëª© ì½”ë“œ
                </label>
                <input type="text" id="stock-ticker" placeholder="ì˜ˆ: AAPL, GOOGL, TSLA, MSFT"
                       class="w-full p-4 border-0 rounded-xl focus:outline-none focus:ring-4 focus:ring-blue-300/50 transition duration-300 text-lg font-medium shadow-lg">
                
                <!-- ì¢…ëª© ì •ë³´ í‘œì‹œ -->
                <div id="stock-info" class="glass p-4 rounded-xl text-white text-center hidden">
                    <div id="company-name" class="font-bold text-lg text-yellow-300"></div>
                    <div id="current-price" class="text-sm text-white/80 mt-1"></div>
                </div>
                
                <!-- ì„ íƒëœ ë‚ ì§œ í‘œì‹œ -->
                <div id="selected-date-display" class="glass p-4 rounded-xl text-white text-center hidden">
                    <span class="font-semibold">ì„ íƒëœ ë‚ ì§œ: </span>
                    <span id="selected-date-text" class="font-bold text-yellow-300"></span>
                </div>
            </div>

            <!-- ë‹¬ë ¥ ì»¨í…Œì´ë„ˆ -->
            <div class="glass p-6 rounded-xl shadow-inner">
                <div class="flex justify-between items-center mb-6">
                    <button id="prev-month" class="text-white hover:text-yellow-300 transition-colors text-2xl font-bold p-2 hover:bg-white/10 rounded-full">
                        â€¹
                    </button>
                    <div id="month-year" class="font-bold text-xl text-white"></div>
                    <button id="next-month" class="text-white hover:text-yellow-300 transition-colors text-2xl font-bold p-2 hover:bg-white/10 rounded-full">
                        â€º
                    </button>
                </div>
                <div class="grid grid-cols-7 gap-1 text-center font-semibold text-sm text-white/80 mb-3">
                    <div class="py-2">ì¼</div>
                    <div class="py-2">ì›”</div>
                    <div class="py-2">í™”</div>
                    <div class="py-2">ìˆ˜</div>
                    <div class="py-2">ëª©</div>
                    <div class="py-2">ê¸ˆ</div>
                    <div class="py-2">í† </div>
                </div>
                <div id="calendar-days" class="grid grid-cols-7 gap-1"></div>
            </div>
        </div>

        <button id="predict-button"
                class="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white font-bold py-4 rounded-xl shadow-xl hover:shadow-2xl focus:outline-none focus:ring-4 focus:ring-blue-300/50 transition duration-300 transform hover:scale-[1.02] text-lg disabled:opacity-50 disabled:cursor-not-allowed">
            ğŸ”® ì‹¤ì‹œê°„ ë°ì´í„°ë¡œ ì‹œê°„ì—¬í–‰ ì˜ˆì¸¡í•˜ê¸°
        </button>

        <div class="mt-8 glass p-8 rounded-2xl border border-white/20">
            <h2 class="text-2xl font-bold mb-6 text-white flex items-center">
                ğŸ“Š ì˜ˆì¸¡ ê²°ê³¼
            </h2>
            
            <div id="loading-spinner" class="flex justify-center mb-6 hidden">
                <div class="spinner"></div>
                <span class="ml-4 text-white font-medium">ì‹¤ì‹œê°„ ë°ì´í„° ë¶„ì„ ë° LSTM ì˜ˆì¸¡ ì¤‘...</span>
            </div>

            <!-- ì˜ˆì¸¡ ê²°ê³¼ í…ìŠ¤íŠ¸ ì¶œë ¥ -->
            <div id="prediction-text" class="text-lg text-white font-medium mb-6 p-4 rounded-xl glass">
                ì—¬ê¸°ì— ì˜ˆì¸¡ ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤. ì¢…ëª© ì½”ë“œë¥¼ ì…ë ¥í•˜ê³  ë‹¬ë ¥ì—ì„œ ë‚ ì§œë¥¼ ì„ íƒí•œ í›„ ì˜ˆì¸¡ ë²„íŠ¼ì„ í´ë¦­í•´ë³´ì„¸ìš”! ğŸ¯
            </div>
            
            <!-- ì‹¤ì œ ê°€ê²© ë° ì •í™•ë„ í‘œì‹œ -->
            <div id="results-container" class="hidden space-y-4">
                <div class="grid md:grid-cols-2 gap-4">
                    <div class="glass p-4 rounded-xl">
                        <div class="text-white/80 text-sm">ì‹¤ì œ ë‹¤ìŒë‚  ì£¼ê°€</div>
                        <div id="actual-price" class="text-2xl font-bold text-white"></div>
                    </div>
                    <div class="glass p-4 rounded-xl">
                        <div class="text-white/80 text-sm">ì˜ˆì¸¡ ì •í™•ë„</div>
                        <div id="accuracy-display" class="text-2xl font-bold"></div>
                    </div>
                </div>
            </div>

            <!-- ì‹œê°í™”ë¥¼ ìœ„í•œ ìº”ë²„ìŠ¤ -->
            <div class="mt-6 glass p-4 rounded-xl">
                <canvas id="predictionChart"></canvas>
            </div>
        </div>
    </div>

    <script>
        // ì„¤ì •
        const API_BASE_URL = 'http://localhost:5000';
        
        // DOM ìš”ì†Œ ê°€ì ¸ì˜¤ê¸°
        const stockTickerInput = document.getElementById('stock-ticker');
        const predictButton = document.getElementById('predict-button');
        const predictionText = document.getElementById('prediction-text');
        const resultsContainer = document.getElementById('results-container');
        const actualPriceEl = document.getElementById('actual-price');
        const accuracyDisplay = document.getElementById('accuracy-display');
        const chartCanvas = document.getElementById('predictionChart');
        const loadingSpinner = document.getElementById('loading-spinner');
        const selectedDateDisplay = document.getElementById('selected-date-display');
        const selectedDateText = document.getElementById('selected-date-text');
        const stockInfo = document.getElementById('stock-info');
        const companyName = document.getElementById('company-name');
        const currentPrice = document.getElementById('current-price');
        
        // ì„œë²„ ìƒíƒœ ê´€ë ¨
        const serverStatus = document.getElementById('server-status');
        const statusIndicator = document.getElementById('status-indicator');
        const statusText = document.getElementById('status-text');
        
        const monthYearEl = document.getElementById('month-year');
        const calendarDaysEl = document.getElementById('calendar-days');
        const prevMonthBtn = document.getElementById('prev-month');
        const nextMonthBtn = document.getElementById('next-month');

        let myChart;
        let currentDate = new Date();
        let selectedDate = null;
        let stockData = null;
        const ctx = chartCanvas.getContext('2d');

        // ì„œë²„ ìƒíƒœ í™•ì¸
        async function checkServerStatus() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/health`);
                if (response.ok) {
                    statusIndicator.className = 'status-indicator status-online';
                    statusText.textContent = 'ğŸŸ¢ ì‹¤ì‹œê°„ ë°ì´í„° ì„œë²„ ì—°ê²°ë¨';
                    return true;
                } else {
                    throw new Error('ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜');
                }
            } catch (error) {
                statusIndicator.className = 'status-indicator status-offline';
                statusText.textContent = 'ğŸ”´ ì„œë²„ ì—°ê²° ì‹¤íŒ¨ - Flask ì„œë²„ë¥¼ ì‹¤í–‰í•´ì£¼ì„¸ìš”';
                return false;
            }
        }

        // Chart.js ì´ˆê¸°í™”
        function initializeChart() {
            if (myChart) {
                myChart.destroy();
            }
            myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'ğŸ“ˆ ì‹¤ì œ ì£¼ê°€',
                        data: [],
                        borderColor: 'rgb(59, 130, 246)',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        borderWidth: 3,
                        pointBackgroundColor: 'rgb(59, 130, 246)',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 6,
                        pointHoverRadius: 8,
                        fill: true,
                        tension: 0.3,
                    }, {
                        label: 'ğŸ”® LSTM ì˜ˆì¸¡',
                        data: [],
                        borderColor: 'rgb(249, 115, 22)',
                        backgroundColor: 'rgb(249, 115, 22)',
                        borderWidth: 3,
                        pointRadius: 8,
                        pointHoverRadius: 10,
                        pointStyle: 'star',
                        borderDash: [5, 5],
                    }, {
                        label: 'âœ… ì‹¤ì œ ê²°ê³¼',
                        data: [],
                        borderColor: 'rgb(34, 197, 94)',
                        backgroundColor: 'rgb(34, 197, 94)',
                        borderWidth: 3,
                        pointRadius: 10,
                        pointHoverRadius: 12,
                        pointStyle: 'circle',
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                color: 'white',
                                font: {
                                    size: 14,
                                    family: 'Inter, sans-serif',
                                    weight: '600'
                                }
                            }
                        },
                        title: {
                            display: true,
                            text: 'ğŸš€ ì‹¤ì‹œê°„ ì£¼ê°€ ì˜ˆì¸¡ ê²°ê³¼',
                            color: 'white',
                            font: {
                                size: 18,
                                family: 'Inter, sans-serif',
                                weight: '700'
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'ë‚ ì§œ',
                                color: 'white',
                                font: {
                                    size: 14,
                                    family: 'Inter, sans-serif'
                                }
                            },
                            ticks: {
                                color: 'white'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'ì£¼ê°€ ($)',
                                color: 'white',
                                font: {
                                    size: 14,
                                    family: 'Inter, sans-serif'
                                }
                            },
                            ticks: {
                                color: 'white'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        }
                    }
                }
            });
        }

        // ì‹¤ì‹œê°„ ì£¼ê°€ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        async function fetchStockData(ticker) {
            try {
                const response = await fetch(`${API_BASE_URL}/api/stock/${ticker}`);
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
                const data = await response.json();
                return data;
            } catch (error) {
                console.error('ì£¼ê°€ ë°ì´í„° ì¡°íšŒ ì‹¤íŒ¨:', error);
                throw error;
            }
        }

        // ì¢…ëª© ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        async function fetchStockInfo(ticker) {
            try {
                const response = await fetch(`${API_BASE_URL}/api/stock/${ticker}/info`);
                if (response.ok) {
                    return await response.json();
                }
                return null;
            } catch (error) {
                console.error('ì¢…ëª© ì •ë³´ ì¡°íšŒ ì‹¤íŒ¨:', error);
                return null;
            }
        }

        // ì¢…ëª© ì½”ë“œ ì…ë ¥ ì‹œ ì •ë³´ í‘œì‹œ
        stockTickerInput.addEventListener('input', async (e) => {
            const ticker = e.target.value.trim().toUpperCase();
            if (ticker.length >= 3) {
                try {
                    const info = await fetchStockInfo(ticker);
                    if (info && info.company_name !== 'N/A') {
                        companyName.textContent = info.company_name;
                        if (info.current_price !== 'N/A') {
                            currentPrice.textContent = `í˜„ì¬ê°€: $${info.current_price}`;
                        } else {
                            currentPrice.textContent = `${info.sector || 'ì •ë³´ ì—†ìŒ'}`;
                        }
                        stockInfo.classList.remove('hidden');
                    } else {
                        stockInfo.classList.add('hidden');
                    }
                } catch (error) {
                    stockInfo.classList.add('hidden');
                }
            } else {
                stockInfo.classList.add('hidden');
            }
        });

        // LSTM ì‹œë®¬ë ˆì´ì…˜ (ë” í˜„ì‹¤ì ì¸ ì˜ˆì¸¡)
        function simulateLSTMPrediction(sequence) {
            if (sequence.length < 5) {
                return null;
            }

            const recent = sequence.slice(-5);
            
            // íŠ¸ë Œë“œ ë¶„ì„
            const shortTrend = (recent[4] - recent[3]) / recent[3];
            const mediumTrend = (recent[4] - recent[2]) / recent[2] / 2;
            const longTrend = (recent[4] - recent[0]) / recent[0] / 4;
            
            // ê°€ì¤‘ í‰ê·  íŠ¸ë Œë“œ
            const weightedTrend = (shortTrend * 0.5 + mediumTrend * 0.3 + longTrend * 0.2);
            
            // ë³€ë™ì„± ê³„ì‚°
            const volatility = Math.sqrt(recent.reduce((sum, price, i) => {
                if (i === 0) return sum;
                const change = (price - recent[i-1]) / recent[i-1];
                return sum + change * change;
            }, 0) / (recent.length - 1));
            
            // ì˜ˆì¸¡ê°’ ê³„ì‚°
            const basePrice = recent[4];
            const trendComponent = basePrice * weightedTrend;
            const noiseComponent = basePrice * volatility * (Math.random() - 0.5) * 1.5;
            const meanReversion = (basePrice - recent.reduce((a, b) => a + b, 0) / recent.length) * -0.1;
            
            const predictedValue = basePrice + trendComponent + noiseComponent + meanReversion;
            return Math.max(predictedValue, basePrice * 0.85);
        }
        
        // ì •í™•ë„ ê³„ì‚° í•¨ìˆ˜
        function calculateAccuracy(predicted, actual) {
            const error = Math.abs((predicted - actual) / actual) * 100;
            if (error <= 2) return { level: 'good', text: `ğŸ¯ ë§¤ìš° ì •í™•! (ì˜¤ì°¨: ${error.toFixed(1)}%)` };
            if (error <= 5) return { level: 'fair', text: `ğŸ‘ ì–‘í˜¸ (ì˜¤ì°¨: ${error.toFixed(1)}%)` };
            return { level: 'poor', text: `ğŸ“ˆ ê°œì„  í•„ìš” (ì˜¤ì°¨: ${error.toFixed(1)}%)` };
        }
        
        // ë‹¬ë ¥ ë Œë”ë§ í•¨ìˆ˜
        function renderCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            const today = new Date();
            const firstDayOfMonth = new Date(year, month, 1);
            const lastDayOfMonth = new Date(year, month + 1, 0);
            const startDayOfWeek = firstDayOfMonth.getDay();

            monthYearEl.textContent = `${year}ë…„ ${month + 1}ì›”`;
            calendarDaysEl.innerHTML = '';

            // ë¹ˆ ë‚ ì§œ ì…€
            for (let i = 0; i < startDayOfWeek; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.classList.add('day', 'empty-day');
                calendarDaysEl.appendChild(emptyDay);
            }

            // ì‹¤ì œ ë‚ ì§œë“¤
            for (let i = 1; i <= lastDayOfMonth.getDate(); i++) {
                const dayEl = document.createElement('div');
                dayEl.classList.add('day');
                dayEl.textContent = i;
                
                const dayDate = new Date(year, month, i);
                
                // ê³¼ê±° ë‚ ì§œë§Œ ì„ íƒ ê°€ëŠ¥ (ìµœì†Œ 7ì¼ ì „ê¹Œì§€)
                const minDate = new Date(today);
                minDate.setDate(today.getDate() - 7);
                
                if (dayDate.getTime() <= minDate.getTime()) {
                    dayEl.addEventListener('click', () => {
                        document.querySelectorAll('.day.selected').forEach(el => el.classList.remove('selected'));
                        dayEl.classList.add('selected');
                        selectedDate = dayDate;
                        
                        selectedDateText.textContent = dayDate.toLocaleDateString('ko-KR', {
                            year: 'numeric',
                            month: 'long',
                            day: 'numeric'
                        });
                        selectedDateDisplay.classList.remove('hidden');
                    });
                } else {
                    dayEl.classList.add('future-day');
                    dayEl.title = 'ì˜ˆì¸¡ì„ ìœ„í•´ 7ì¼ ì „ ê¹Œì§€ì˜ ë‚ ì§œë§Œ ì„ íƒ ê°€ëŠ¥í•©ë‹ˆë‹¤';
                }

                if (selectedDate && dayDate.toDateString() === selectedDate.toDateString()) {
                    dayEl.classList.add('selected');
                }

                calendarDaysEl.appendChild(dayEl);
            }
        }

        // ì´ì „/ë‹¤ìŒ ë‹¬ ë²„íŠ¼ ì´ë²¤íŠ¸
        prevMonthBtn.addEventListener('click', () => {
            currentDate.setMonth(currentDate.getMonth() - 1);
            renderCalendar();
        });

        nextMonthBtn.addEventListener('click', () => {
            currentDate.setMonth(currentDate.getMonth() + 1);
            renderCalendar();
        });

        // ì˜ˆì¸¡ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
        predictButton.addEventListener('click', async () => {
            const ticker = stockTickerInput.value.trim().toUpperCase();

            // ì„œë²„ ì—°ê²° í™•ì¸
            const serverOnline = await checkServerStatus();
            if (!serverOnline) {
                predictionText.innerHTML = "ğŸš¨ <strong>ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤!</strong><br>Flask ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.";
                predictionText.className = "text-lg text-red-300 font-medium mb-6 p-4 rounded-xl glass pulse";
                return;
            }

            // ì…ë ¥ ê²€ì¦
            if (!ticker) {
                predictionText.innerHTML = "ğŸš¨ <strong>ìœ íš¨í•œ ì¢…ëª© ì½”ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!</strong>";
                predictionText.className = "text-lg text-red-300 font-medium mb-6 p-4 rounded-xl glass pulse";
                return;
            }

            if (!selectedDate) {
                predictionText.innerHTML = "ğŸ“… <strong>ë°±í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ ë‹¬ë ¥ì—ì„œ ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”!</strong>";
                predictionText.className = "text-lg text-yellow-300 font-medium mb-6 p-4 rounded-xl glass pulse";
                return;
            }

            // UI ì´ˆê¸°í™” ë° ë¡œë”© í‘œì‹œ
            predictButton.disabled = true;
            loadingSpinner.classList.remove('hidden');
            predictionText.innerHTML = "ğŸŒ ì‹¤ì‹œê°„ ì£¼ê°€ ë°ì´í„° ë‹¤ìš´ë¡œë“œ ì¤‘...";
            predictionText.className = "text-lg text-white font-medium mb-6 p-4 rounded-xl glass";
            resultsContainer.classList.add('hidden');
            
            // ì°¨íŠ¸ ì´ˆê¸°í™”
            myChart.data.labels = [];
            myChart.data.datasets[0].data = [];
            myChart.data.datasets[1].data = [];
            myChart.data.datasets[2].data = [];
            myChart.update();

            try {
                // ì‹¤ì‹œê°„ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                predictionText.innerHTML = "ğŸ“¡ Yahoo Financeì—ì„œ ì‹¤ì‹œê°„ ë°ì´í„° ìˆ˜ì‹  ì¤‘...";
                const stockResponse = await fetchStockData(ticker);
                stockData = stockResponse.data;

                predictionText.innerHTML = `âœ… ${stockResponse.company_name} ë°ì´í„° ìˆ˜ì‹  ì™„ë£Œ!<br>ğŸ¤– LSTM ì‹ ê²½ë§ ë¶„ì„ ì¤‘...`;
                await new Promise(resolve => setTimeout(resolve, 1500)); // ì‹œê°ì  íš¨ê³¼

                // ì„ íƒí•œ ë‚ ì§œë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë°ì´í„° ë¶„í• 
                const selectedDateString = selectedDate.toISOString().split('T')[0];
                const selectedIndex = stockData.findIndex(item => item.date === selectedDateString);

                if (selectedIndex === -1) {
                    throw new Error(`ì„ íƒí•œ ë‚ ì§œ(${selectedDateString})ì˜ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë‹¤ë¥¸ ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.`);
                }

                if (selectedIndex < 4) {
                    throw new Error("ì„ íƒí•œ ë‚ ì§œì˜ ë°ì´í„°ê°€ ì¶©ë¶„í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. (ìµœì†Œ 5ì¼ í•„ìš”)");
                }

                const pricesForPrediction = stockData.slice(0, selectedIndex + 1).map(item => item.price);
                const datesForDisplay = stockData.slice(0, selectedIndex + 1).map(item => 
                    new Date(item.date).toLocaleDateString('ko-KR', { month: 'short', day: 'numeric' })
                );

                // LSTM ì˜ˆì¸¡ ìˆ˜í–‰
                predictionText.innerHTML = "ğŸ§  LSTM ì‹ ê²½ë§ìœ¼ë¡œ ì˜ˆì¸¡ê°’ ê³„ì‚° ì¤‘...";
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                const predictedValue = simulateLSTMPrediction(pricesForPrediction);
                
                // ì‹¤ì œ ë‹¤ìŒë‚  ì£¼ê°€ ê°€ì ¸ì˜¤ê¸°
                const actualNextDay = stockData[selectedIndex + 1];
                const nextDayDateFormatted = actualNextDay ? 
                    new Date(actualNextDay.date).toLocaleDateString('ko-KR', { month: 'short', day: 'numeric' }) : 
                    'ë°ì´í„° ì—†ìŒ';

                // ì°¨íŠ¸ ë°ì´í„° ì—…ë°ì´íŠ¸
                const chartLabels = [...datesForDisplay];
                const actualPrices = [...pricesForPrediction];
                const predictedPrices = new Array(pricesForPrediction.length).fill(null);
                const actualResults = new Array(pricesForPrediction.length).fill(null);
                
                if (actualNextDay) {
                    chartLabels.push(nextDayDateFormatted);
                    actualPrices.push(actualNextDay.price);
                    predictedPrices.push(predictedValue);
                    actualResults.push(actualNextDay.price);
                } else {
                    chartLabels.push('ì˜ˆì¸¡ì¼');
                    actualPrices.push(null);
                    predictedPrices.push(predictedValue);
                    actualResults.push(null);
                }

                myChart.data.labels = chartLabels;
                myChart.data.datasets[0].data = actualPrices;
                myChart.data.datasets[1].data = predictedPrices;
                myChart.data.datasets[2].data = actualResults;
                myChart.update();

                // ê²°ê³¼ í‘œì‹œ
                const selectedDateFormatted = selectedDate.toLocaleDateString('ko-KR', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });

                predictionText.innerHTML = `
                    ğŸ¯ <strong>${stockResponse.company_name} (${ticker})</strong><br>
                    ğŸ“… <strong>${selectedDateFormatted}</strong> ê¸°ì¤€ ì‹œê°„ì—¬í–‰ ì™„ë£Œ!<br>
                    ğŸ”® LSTM ì˜ˆì¸¡ ë‹¤ìŒë‚  ì£¼ê°€: <span class="text-yellow-300 font-bold text-xl">${predictedValue.toFixed(2)}</span>
                `;
                predictionText.className = "text-lg text-white font-medium mb-6 p-4 rounded-xl glass";

                if (actualNextDay) {
                    const accuracy = calculateAccuracy(predictedValue, actualNextDay.price);
                    
                    actualPriceEl.textContent = `${actualNextDay.price.toFixed(2)}`;
                    accuracyDisplay.innerHTML = `<span class="accuracy-indicator accuracy-${accuracy.level}">${accuracy.text}</span>`;
                    resultsContainer.classList.remove('hidden');
                } else {
                    predictionText.innerHTML += '<br><span class="text-orange-300">âš ï¸ ë‹¤ìŒë‚  ì‹¤ì œ ë°ì´í„°ê°€ ì—†ì–´ ì •í™•ë„ë¥¼ ê³„ì‚°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</span>';
                    resultsContainer.classList.add('hidden');
                }

            } catch (error) {
                console.error('ì˜ˆì¸¡ ì˜¤ë¥˜:', error);
                predictionText.innerHTML = `ğŸš¨ <strong>ì˜¤ë¥˜ ë°œìƒ:</strong> ${error.message}`;
                predictionText.className = "text-lg text-red-300 font-medium mb-6 p-4 rounded-xl glass pulse";
                resultsContainer.classList.add('hidden');
            } finally {
                // ë¡œë”© ìˆ¨ê¸°ê¸° ë° ë²„íŠ¼ í™œì„±í™”
                loadingSpinner.classList.add('hidden');
                predictButton.disabled = false;
            }
        });

        // í‚¤ë³´ë“œ ì´ë²¤íŠ¸ (Enterí‚¤ë¡œ ì˜ˆì¸¡ ì‹¤í–‰)
        stockTickerInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !predictButton.disabled) {
                predictButton.click();
            }
        });

        // ì°¨íŠ¸ ì»¨í…Œì´ë„ˆ ë†’ì´ ì„¤ì •
        function setChartHeight() {
            chartCanvas.style.height = '400px';
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.onload = async function() {
            initializeChart();
            renderCalendar();
            setChartHeight();
            
            // ì„œë²„ ìƒíƒœ í™•ì¸
            await checkServerStatus();
            
            // ê¸°ë³¸ ë‚ ì§œë¥¼ 2ì£¼ì¼ ì „ìœ¼ë¡œ ì„¤ì •
            const defaultDate = new Date();
            defaultDate.setDate(defaultDate.getDate() - 14);
            selectedDate = defaultDate;
            currentDate = new Date(defaultDate.getFullYear(), defaultDate.getMonth(), 1);
            renderCalendar();
            
            selectedDateText.textContent = defaultDate.toLocaleDateString('ko-KR', {
                year: 'numeric',
                month: 'long', 
                day: 'numeric'
            });
            selectedDateDisplay.classList.remove('hidden');

            // ê¸°ë³¸ ì¢…ëª© ì„¤ì •
            stockTickerInput.value = 'AAPL';
            stockTickerInput.dispatchEvent(new Event('input'));
        };

        // ì£¼ê¸°ì  ì„œë²„ ìƒíƒœ í™•ì¸ (30ì´ˆë§ˆë‹¤)
        setInterval(checkServerStatus, 30000);

        // ë°˜ì‘í˜• ì²˜ë¦¬
        window.addEventListener('resize', () => {
            if (myChart) {
                myChart.resize();
            }
        });
    </script>
</body>
</html>